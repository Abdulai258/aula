<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Suporte</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="estilo.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Suporte ao Cliente</a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="index.html">Home</a>
        <a class="nav-link" href="chat.html">Chat</a>
      </div>
    </div>
  </nav>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow-lg border-0">
          <div class="card-body">
            <h1 class="card-title text-center mb-4">Painel do Administrador</h1>
            <h3>Chat</h3>
            <div id="admin-messages" class="chat-box mb-3"></div>
            <form id="admin-form">
              <div class="input-group">
                <input type="text" id="admin-message" class="form-control form-control-lg" placeholder="Responda aqui..." required>
                <button type="submit" class="btn btn-primary btn-lg">Enviar</button>
              </div>
            </form>
            <h3 class="mt-4">Chamados</h3>
            <div id="tickets" class="mb-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const ws = new WebSocket('ws://localhost:3000');
    const adminMessagesDiv = document.getElementById('admin-messages');
    const ticketsDiv = document.getElementById('tickets');

    ws.onopen = () => {
      console.log('Conectado como admin');
      ws.send('IDENTIFY:ADMIN');
    };

    ws.onmessage = (event) => {
      const msg = event.data;
      adminMessagesDiv.innerHTML += `<div class="message">${msg}</div>`;
      adminMessagesDiv.scrollTop = adminMessagesDiv.scrollHeight;
    };

    document.getElementById('admin-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const message = document.getElementById('admin-message').value;
      ws.send(message);
      document.getElementById('admin-message').value = '';
    });

    // Carregar chamados via AJAX
    function loadTickets() {
      fetch('/api/tickets')
        .then(res => res.json())
        .then(tickets => {
          ticketsDiv.innerHTML = tickets.map(t => `<div class="alert alert-info">ID: ${t.id} - ${t.username}: ${t.description} (Status: ${t.status})</div>`).join('');
        });
    }
    loadTickets(); // Carrega ao abrir a p√°gina
    setInterval(loadTickets, 5000); // Atualiza a cada 5 segundos
  </script>
</html>